function battle(t,n){for(var e=[];t.hp>0&&n.hp>0;)e.push(fight(t,n)),e.push(fight(n,t));return e}function fight(t,n){return hit=rollDice("1d20"+t.bab)>=n.ac,dmg=hit?rollDice(t.damage):0,n.hp-=dmg,{name:t.name,hp:t.hp,dmg:dmg}}function toLog(t){return t.map(function(t){return[t.name,t.dmg>0?" strikes with "+t.dmg+" damage. ":"fumbles and misses. ","he still has ",t.hp,"HP."].join(" ")})}

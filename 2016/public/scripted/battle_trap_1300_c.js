function writeText(e,n,t,r){c.fillStyle="#001f3f",c.fillRect(0,0,a.width,a.height),c.fillStyle="#01FF70",r.forEach(function(a,r){c.fillText(a,e,n+r*t),console.log(a)})}function render(a){var e=0,n=[],t=window.setInterval(function(){return e===a.length?void window.clearInterval(t):(n.length===MAX_DISPLAY_LINES&&n.shift(),n.push(a[e]),e+=1,void write(n))},1e3)}function rollDice(a){for(var e=/(\d*)d(\d+)([+-]?\d*)/.exec(a),n=0|e[1]||1,t=0|e[2],r=0|e[3],o=0;n--;)o+=0|Math.random()*t+1;return o+=r}function battle(a,e){var n,t=["I spotted a "+e.name+".",d20()+a.bab>=e.ac?"The "+e.name+" was no match for me!":"I managed to flee."];return d20()+e.bab>a.ac&&(n=e.dmg(),a.hp-=n,t.push("I took "+n+" damage.")),t}function trap(a,e){var n=["I see a "+e.name],t=d20()+a.bab;return t>=e.ac?n.push("I found some gold coins!"):(n.push("It was a trap!"),t=e.dmg(),a.hp-=t,n.push("I took "+t+" damage.")),n}function run(){for(var a,e=[],n={hp:11,bab:5,ac:17},t={name:"Goblin",bab:2,ac:13,dmg:d4},r={name:"strange rocks",ac:13,dmg:d4};n.hp>0;)d4()>2?(a=battle(n,t),e=e.concat(a)):(a=trap(n,r),e=e.concat(a));return e}var MAX_DISPLAY_LINES=5,LINE_HEIGHT=75;c.font="36px Papyrus, fantasy";var write=writeText.bind(null,100,100,LINE_HEIGHT),d20=rollDice.bind(0,"1d20"),d4=rollDice.bind(0,"1d4"),log=run();render(log);

function writeText(e,t,n,r){c.fillStyle="#001f3f",c.fillRect(0,0,a.width,a.height),c.fillStyle="#01FF70",r.forEach(function(a,r){c.fillText(a,e,t+r*n),console.log(a)})}function render(e){function t(n,r){var o=DELAY.PAGE;return a.length===MAX_DISPLAY_LINES&&a.shift(),e[n].length===r&&(o=DELAY.CHAPTER,n+=1,r=0),e.length===n?(a.push("I've been defeated."),void write(a)):(a.push(e[n][r]),write(a),r+=1,void setTimeout(t.bind(0,n,r),o))}var a=[];t(0,0)}function rollDice(e){for(var t=/(\d*)d(\d+)([+-]?\d*)/.exec(e),a=0|t[1]||1,n=0|t[2],r=0|t[3],o=0;a--;)o+=0|Math.random()*n+1;return o+=r}function battle(e,t){var a,n=["I spotted a "+t.name+".",d20()+e.bab>=t.ac?"The "+t.name+" was no match for me!":"I managed to flee."];return d20()+t.bab>e.ac&&(a=t.dmg(),e.hp-=a,n.push("I took "+a+" damage.")),n}function trap(e,t){var a=["I see a "+t.name],n=d20()+e.bab;return n>=t.ac?(a.push("I found some gold coins!"),e.gold+=d4()):(a.push("It was a trap!"),n=t.dmg(),e.hp-=n,a.push("I took "+n+" damage.")),a}function status(e){var t=["Status: HP "+e.hp+", Gold "+e.gold];return t}function run(){for(var e,t,a=[],n={hp:11,bab:5,ac:17,gold:0},r={name:"Goblin",bab:2,ac:13,dmg:d4},o={name:"strange rocks",ac:13,dmg:d4};n.hp>0;)t=d4(),1===t&&(e=battle(n,r)),2===t&&(e=trap(n,o)),a.push(e);return a}var MAX_DISPLAY_LINES=5,LINE_HEIGHT=75,DELAY={PAGE:1e3,CHAPTER:2e3};c.font="36px Papyrus, fantasy";var write=writeText.bind(null,100,100,LINE_HEIGHT),d20=rollDice.bind(0,"1d20"),d4=rollDice.bind(0,"1d4"),log=run();render(log);

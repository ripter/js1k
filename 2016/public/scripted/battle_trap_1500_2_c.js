function writeText(e,t,n,r){c.fillStyle="#001f3f",c.fillRect(0,0,a.width,a.height),c.fillStyle="#01FF70",r.forEach(function(a,r){c.fillText(a,e,t+r*n),console.log(a)})}function render(e){function t(e){return a.length===MAX_DISPLAY_LINES&&a.shift(),a.push(e),a}function n(a,r){var o=e[a],d=o[r];return e.length===a?write(t("I've been defeated.")):o.length===r?setTimeout(n.bind(0,a+1,0),DELAY.CHAPTER):(write(t(d)),void setTimeout(n.bind(0,a,r+1),DELAY.PAGE))}var a=[];n(0,0)}function rollDice(e){for(var t=/(\d*)d(\d+)([+-]?\d*)/.exec(e),n=0|t[1]||1,a=0|t[2],r=0|t[3],o=0;n--;)o+=0|Math.random()*a+1;return o+=r}function battle(e,t){var n,a=["I spotted a "+t.name+".",d20()+e.bab>=t.ac?"The "+t.name+" was no match for me!":"I managed to flee."];return d20()+t.bab>e.ac&&(n=t.dmg(),e.hp-=n,a.push("I took "+n+" damage.")),a}function trap(e,t){var n=["I see a "+t.name],a=d20()+e.bab;return a>=t.ac?(n.push("I found some gold coins!"),e.gold+=d4()):(n.push("It was a trap!"),a=t.dmg(),e.hp-=a,n.push("I took "+a+" damage.")),n}function status(e){var t=["Status: HP "+e.hp+", Gold "+e.gold];return t}function run(){for(var e,t,n=[],a={hp:11,bab:5,ac:17,gold:0},r={name:"Goblin",bab:2,ac:13,dmg:d4},o={name:"strange rocks",ac:13,dmg:d4};a.hp>0;)t=d4(),1===t&&(e=battle(a,r)),2===t&&(e=trap(a,o)),n.push(e);return n}var MAX_DISPLAY_LINES=5,LINE_HEIGHT=75,DELAY={PAGE:1e3,CHAPTER:2e3};c.font="36px Papyrus, fantasy";var write=writeText.bind(null,100,100,LINE_HEIGHT),d20=rollDice.bind(0,"1d20"),d4=rollDice.bind(0,"1d4"),log=run();render(log);

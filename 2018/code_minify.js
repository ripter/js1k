const WIDTH=312,HEIGHT=390,FRAME_LENGTH=10,FRAME_RATE=250,VPOINT={X:157,Y:215},NONE=0,COIN=1,BOMB=2,RECT_TOP=0,RECT_LEFT=1,RECT_BOTTOM=2,RECT_RIGHT=3,ITEM_X=4,ITEM_Y=5;let score=0,frame=0,lastTimestamp=-FRAME_RATE,isKeyDown=!1,didScore=0,lives=3,activeType=0,delayTime=0,canScore=!1;const FRAMES=[[0,0,3,8,5,4],[3,8,5,16,10,10],[5,16,8,24,15,16],[8,24,11,32,20,24],[11,32,15,44,25,36],[15,44,19,58,30,48],[19,58,22,70,35,60],[22,70,29,90,40,75],[29,90,35,112,45,99],[35,112,45,140,50,122],[45,140,55,175,55,155]];console.log('Coin Miner 2018'),a.addEventListener('click',(b)=>{console.log(b),isKeyDown=!0}),a.addEventListener('touchend',(b)=>{console.log(b),isKeyDown=!0});function updateScore(){isKeyDown&&canScore&&activeType==COIN&&(score+=1,c.fillStyle='rgba(0, 0, 255, .8)',c.fillRect(0,0,WIDTH,HEIGHT)),isKeyDown&&canScore&&activeType==BOMB&&(lives-=1,c.fillStyle='rgba(255, 0, 0, .8)',c.fillRect(0,0,WIDTH,HEIGHT)),isKeyDown=!1,canScore=!1}function renderHeader(){c.font='24px monospace',c.fillStyle='#f0f0b5';let b='';for(var d=0;d<lives;d++)b+='\uD83D\uDCA3';c.fillText(`ðŸ’Ž ${score}`,10,30),c.fillText(b,WIDTH-90,30)}function renderScore(){c.font='24px monospace',c.fillStyle='#f0f0b5',c.fillText(`Coins: ${score}`,10,24)}function renderCoin(){if(activeType!=COIN)return;if(frame<delayTime)return;const b=[155,215,1,155,235,2,150,265,4,140,315,9];let d=frame-delayTime;d==b.length/3&&(canScore=!0);d>b.length/3-1||(d*=3,drawCoin(b[d],b[d+1],b[d+2]))}function drawPlank(b){const d=65/2,e=VPOINT.X-d,f=VPOINT.X+d;c.beginPath(),c.moveTo(e-b[RECT_TOP],VPOINT.Y+b[RECT_LEFT]),c.lineTo(f+b[RECT_TOP],VPOINT.Y+b[RECT_LEFT]),c.lineTo(f+b[RECT_BOTTOM],VPOINT.Y+b[RECT_RIGHT]),c.lineTo(e-b[RECT_BOTTOM],VPOINT.Y+b[RECT_RIGHT]),c.lineTo(e-b[RECT_TOP],VPOINT.Y+b[RECT_LEFT]),c.fill(),c.stroke()}function drawBomb(b,d){const e=VPOINT.X-b[ITEM_X],f=VPOINT.Y+b[ITEM_Y];c.font=`${12*d}px serif`,c.fillText('\uD83D\uDCA3',e,f)}function drawCoin(b,d){const e=VPOINT.X-b[ITEM_X],f=VPOINT.Y+b[ITEM_Y];c.font=`${12*d}px serif`,c.fillText('\uD83D\uDC8E',e,f)}function renderBomb(){if(activeType!=BOMB)return;if(frame<delayTime)return;const b=[155,215,1,155,235,2,150,265,4,140,315,9];let d=frame-delayTime;d==b.length/3-1&&(canScore=!0);d>b.length/3||(d*=3,drawBomb(b[d],b[d+1],b[d+2]))}function clearScreen(){c.fillStyle='#725636',c.fillRect(0,0,WIDTH,HEIGHT)}function renderCave(){c.beginPath(),c.arc(WIDTH/2,HEIGHT/2,WIDTH/2,0,1*Math.PI,!0),c.rect(0,HEIGHT/2,WIDTH,HEIGHT/2),c.fillStyle='#000',c.fill()}function renderTrack(){const b=125,d=190,e=215;let f=[[0,0,3,8],[3,8,5,16],[5,16,8,24],[8,24,11,32],[11,32,15,44],[15,44,19,58],[19,58,22,70],[22,70,29,90],[29,90,35,112],[35,112,45,140],[45,140,55,175]];f=f.filter((b,d)=>0==frame%2?0==d%2:0!=d%2),c.strokeStyle='#392b1b',c.fillStyle='#392b1b',c.beginPath(),f.forEach((f)=>{c.moveTo(b-f[0],e+f[1]),c.lineTo(d+f[0],e+f[1]),c.lineTo(d+f[2],e+f[3]),c.lineTo(b-f[2],e+f[3]),c.lineTo(b-f[0],e+f[1])}),c.fill(),c.stroke()}function tick(b=0){b=0|b;const d=0|b-lastTimestamp;d>=FRAME_RATE&&(console.log('%cframe','color: #ddd;',frame),lastTimestamp=b,clearScreen(),renderCave(),renderTrack(),updateScore(),renderHeader(),0>=lives?c.fillText(`Game Over`,WIDTH/2-70,HEIGHT/2-25):activeType||(.5<Math.random()?(activeType=COIN,delayTime=0|3*Math.random(),console.log('set activeType = COIN',activeType,delayTime)):(activeType=BOMB,delayTime=0|3*Math.random(),console.log('set activeType = BOMB',activeType,delayTime))),c.fillStyle='green',c.strokeStyle='red',drawPlank(FRAMES[frame]),drawCoin(FRAMES[frame],frame+1),frame+=1,frame===FRAMES.length&&(frame=0,activeType=NONE)),0<lives&&!window.pause&&window.requestAnimationFrame(tick)}tick(),window.addEventListener('keydown',(b)=>{console.log(b),'Space'===b.code&&(b.shiftKey&&(frame-=2,0>frame&&(frame=FRAME_LENGTH)),console.log('skipping to frame',frame),requestAnimationFrame(tick))});